<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="assets/images/favicon.png">
  <title>Set Up Your Salon Profile - PostMyStyle.ai</title>
  <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        padding: 2rem;
    }

    .onboarding-container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        animation: slideUp 0.8s ease-out;
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(40px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .onboarding-header {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 3rem 2rem;
        text-align: center;
    }

    .onboarding-header h1 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
    }

    .onboarding-header p {
        font-size: 1.1rem;
        opacity: 0.9;
        max-width: 600px;
        margin: 0 auto;
    }

    .progress-bar {
        background: rgba(255, 255, 255, 0.2);
        height: 4px;
        border-radius: 2px;
        margin-top: 2rem;
        overflow: hidden;
    }

    .progress-fill {
        background: white;
        height: 100%;
        width: 50%;
        border-radius: 2px;
        transition: width 0.3s ease;
    }

    .onboarding-content {
        padding: 3rem;
    }

    .form-section {
        margin-bottom: 3rem;
    }

    .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .section-subtitle {
        color: #666;
        margin-bottom: 2rem;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group.full-width {
        grid-column: 1 / -1;
    }

    label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #333;
    }

    .required {
        color: #e74c3c;
    }

    input, textarea {
        width: 100%;
        padding: 1rem;
        border: 2px solid #e1e5e9;
        border-radius: 10px;
        font-size: 1rem;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
        font-family: inherit;
    }

    textarea {
        resize: vertical;
        min-height: 100px;
    }

    input:focus, textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .input-error {
        border-color: #e74c3c !important;
        box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1) !important;
    }

    .error-message {
        color: #e74c3c;
        font-size: 0.875rem;
        margin-top: 0.25rem;
        display: none;
    }

    .input-hint {
        font-size: 0.875rem;
        color: #666;
        margin-top: 0.25rem;
    }

    .social-input {
        position: relative;
    }

    .social-prefix {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #666;
        font-weight: 500;
        z-index: 1;
    }

    .social-input input {
        padding-left: 2.5rem;
    }

    .submit-btn {
        width: 100%;
        padding: 1.2rem 2rem;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        margin-top: 2rem;
    }

    .submit-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
    }

    .submit-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .loading {
        display: none;
        width: 20px;
        height: 20px;
        border: 2px solid transparent;
        border-top: 2px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 0.5rem;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .success-message {
        background: #d4edda;
        color: #155724;
        padding: 1rem;
        border-radius: 10px;
        margin-bottom: 2rem;
        display: none;
        text-align: center;
    }

    .welcome-section {
        background: #e8f4fd;
        border-left: 4px solid #667eea;
        padding: 1.5rem;
        border-radius: 10px;
        margin-bottom: 2rem;
    }

    .welcome-section h3 {
        color: #667eea;
        margin-bottom: 0.5rem;
    }

    @media (max-width: 768px) {
        body {
            padding: 1rem;
        }

        .onboarding-content {
            padding: 2rem;
        }

        .form-grid {
            grid-template-columns: 1fr;
        }

        .onboarding-header h1 {
            font-size: 2rem;
        }
    }
  </style>
</head>
<body>
<div class="onboarding-container">
  <div class="onboarding-header">
    <h1>Welcome to PostMyStyle.ai! üéâ</h1>
    <p>Let's set up your salon profile to start generating amazing content and growing your business</p>
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
  </div>

  <div class="onboarding-content">
    <div class="welcome-section">
      <h3 id="welcomeTitle">üöÄ Welcome Beta Tester!</h3>
      <p id="welcomeMessage">You're part of our exclusive 14-day beta program. Your feedback will help shape the future of PostMyStyle.ai!</p>
    </div>

    <div class="success-message" id="successMessage">
      <strong>Profile Created Successfully!</strong><br>
      Redirecting to your dashboard...
    </div>

    <form id="salonForm">
      <!-- Basic Information Section -->
      <div class="form-section">
        <h2 class="section-title">
          üè™ Salon Information
        </h2>
        <p class="section-subtitle">Tell us about your salon so we can create personalized content</p>

        <div class="form-grid">
          <div class="form-group">
            <label for="salonName">Salon Name <span class="required">*</span></label>
            <input type="text" id="salonName" name="salonName" required>
            <div class="error-message" id="salonNameError">Salon name is required</div>
          </div>

          <div class="form-group">
            <label for="phone">Phone Number <span class="required">*</span></label>
            <input type="tel" id="phone" name="phone" required placeholder="(555) 123-4567">
            <div class="error-message" id="phoneError">Phone number is required</div>
          </div>
        </div>

        <div class="form-group full-width">
          <label for="address">Salon Address <span class="required">*</span></label>
          <input type="text" id="address" name="address" required placeholder="123 Main St, City, State 12345">
          <div class="input-hint">This helps us create location-specific content and connect with local clients</div>
          <div class="error-message" id="addressError">Address is required</div>
        </div>

        <div class="form-group">
          <label for="email">Business Email <span class="required">*</span></label>
          <input type="email" id="email" name="email" required>
          <div class="input-hint">This can be different from your login email</div>
          <div class="error-message" id="emailError">Valid business email is required</div>
        </div>
      </div>

      <!-- Social Media Section -->
      <div class="form-section">
        <h2 class="section-title">
          üì± Social Media Presence
        </h2>
        <p class="section-subtitle">Connect your social accounts to optimize content for each platform</p>

        <div class="form-grid">
          <div class="form-group">
            <label for="instagramHandle">Instagram Handle <span class="required">*</span></label>
            <div class="social-input">
              <span class="social-prefix">@</span>
              <input type="text" id="instagramHandle" name="instagramHandle" required placeholder="yoursalon">
            </div>
            <div class="error-message" id="instagramError">Instagram handle is required</div>
          </div>

          <div class="form-group">
            <label for="facebookHandle">Facebook Page <span class="required">*</span></label>
            <div class="social-input">
              <span class="social-prefix">@</span>
              <input type="text" id="facebookHandle" name="facebookHandle" required placeholder="yoursalon">
            </div>
            <div class="error-message" id="facebookError">Facebook handle is required</div>
          </div>

          <div class="form-group">
            <label for="tiktokHandle">TikTok Handle (Optional)</label>
            <div class="social-input">
              <span class="social-prefix">@</span>
              <input type="text" id="tiktokHandle" name="tiktokHandle" placeholder="yoursalon">
            </div>
            <div class="input-hint">Add TikTok to create viral short-form content</div>
          </div>
        </div>
      </div>

      <!-- Additional Settings Section -->
      <div class="form-section">
        <h2 class="section-title">
          ‚öôÔ∏è Content Preferences
        </h2>
        <p class="section-subtitle">Help us personalize your AI-generated content</p>

        <div class="form-group">
          <label for="cannedTags">Signature Hashtags & Keywords (Optional)</label>
          <textarea id="cannedTags" name="cannedTags" placeholder="Enter your favorite hashtags, specialties, or keywords separated by commas. Example: #balayage, #colorcorrection, #hairtransformation, color specialist, wedding hair"></textarea>
          <div class="input-hint">These will be included in your AI-generated content to maintain brand consistency</div>
        </div>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">
        <span class="loading" id="loading"></span>
        <span id="submitText">Complete Setup & Go to Dashboard</span>
      </button>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // ‚ö†Ô∏è REPLACE THESE WITH YOUR ACTUAL SUPABASE CREDENTIALS
  const supabaseUrl = 'https://mffqaqvjylkotkgvytro.supabase.co'        // Replace with your Project URL
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1mZnFhcXZqeWxrb3RrZ3Z5dHJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYxMTI5MzYsImV4cCI6MjA2MTY4ODkzNn0.oUlS-JS1G9OHjwv89xZY_QRqwsoI-GE8c-ZE_U2TjDc'                  // Replace with your anon/public key
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)

  // Get payment completion data
  const paymentData = JSON.parse(sessionStorage.getItem('paymentComplete') || '{}');
  const pendingUser = JSON.parse(sessionStorage.getItem('pendingUser') || '{}');

  // Redirect if no payment data
  if (!paymentData.userId) {
      alert('Session expired. Please complete signup and payment first.');
      window.location.href = 'signup.html';
  }

  // Update welcome message based on plan
  function updateWelcomeMessage() {
      const welcomeTitle = document.getElementById('welcomeTitle');
      const welcomeMessage = document.getElementById('welcomeMessage');

      if (paymentData.betaTester || paymentData.plan === 'beta') {
          welcomeTitle.innerHTML = 'üöÄ Welcome Beta Tester!';
          welcomeMessage.innerHTML = 'You\'re part of our exclusive 14-day beta program. Your feedback will help shape the future of PostMyStyle.ai!';
      } else {
          welcomeTitle.innerHTML = 'üöÄ Payment Successful!';
          welcomeMessage.innerHTML = 'Your 7-day free trial has started. Complete your salon profile below to begin creating AI-powered content.';
      }
  }

  // Call function to update welcome message
  updateWelcomeMessage();

  // Pre-fill email from user registration
  document.getElementById('email').value = pendingUser.email || '';

  // Update progress bar
  function updateProgress(percentage) {
      document.getElementById('progressFill').style.width = percentage + '%';
  }

  // Form validation functions
  function validateField(field, errorElement, validationFn) {
      field.addEventListener('blur', () => {
          if (!validationFn()) {
              field.classList.add('input-error');
              errorElement.style.display = 'block';
          } else {
              field.classList.remove('input-error');
              errorElement.style.display = 'none';
          }
          updateProgress(calculateProgress());
      });

      field.addEventListener('input', () => {
          if (field.classList.contains('input-error') && validationFn()) {
              field.classList.remove('input-error');
              errorElement.style.display = 'none';
          }
          updateProgress(calculateProgress());
      });
  }

  // Calculate form completion progress
  function calculateProgress() {
      const requiredFields = [
          'salonName', 'address', 'phone', 'email', 'instagramHandle', 'facebookHandle'
      ];

      let completed = 0;
      requiredFields.forEach(fieldId => {
          if (document.getElementById(fieldId).value.trim()) {
              completed++;
          }
      });

      return Math.round((completed / requiredFields.length) * 100);
  }

  // Set up field validation
  validateField(
      document.getElementById('salonName'),
      document.getElementById('salonNameError'),
      () => document.getElementById('salonName').value.trim().length > 0
  );

  validateField(
      document.getElementById('address'),
      document.getElementById('addressError'),
      () => document.getElementById('address').value.trim().length > 5
  );

  validateField(
      document.getElementById('phone'),
      document.getElementById('phoneError'),
      () => {
          const phone = document.getElementById('phone').value.trim();
          return phone.length >= 10;
      }
  );

  validateField(
      document.getElementById('email'),
      document.getElementById('emailError'),
      () => {
          const email = document.getElementById('email').value;
          return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }
  );

  validateField(
      document.getElementById('instagramHandle'),
      document.getElementById('instagramError'),
      () => document.getElementById('instagramHandle').value.trim().length > 0
  );

  validateField(
      document.getElementById('facebookHandle'),
      document.getElementById('facebookError'),
      () => document.getElementById('facebookHandle').value.trim().length > 0
  );

  // Form submission
  const form = document.getElementById('salonForm');
  const submitBtn = document.getElementById('submitBtn');
  const loading = document.getElementById('loading');
  const submitText = document.getElementById('submitText');
  const successMessage = document.getElementById('successMessage');

  form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Show loading state
      submitBtn.disabled = true;
      loading.style.display = 'inline-block';
      submitText.textContent = 'Creating Your Profile...';

      // Collect form data
      const formData = new FormData(form);
      const salonData = {
          salon_name: formData.get('salonName'),
          address: formData.get('address'),
          phone: formData.get('phone'),
          email: formData.get('email'),
          instagram_handle: formData.get('instagramHandle'),
          facebook_handle: formData.get('facebookHandle'),
          tiktok_handle: formData.get('tiktokHandle') || null,
          canned_tags: formData.get('cannedTags') || null,
          status: 'active'
      };

      try {
          // Create salon profile
          const { data: salonResult, error: salonError } = await supabase
              .from('salons')
              .insert([salonData])
              .select()
              .single();

          if (salonError) {
              throw new Error(salonError.message);
          }

          // Link salon to user
          const { error: linkError } = await supabase
              .from('user_salons')
              .insert([{
                  user_id: paymentData.userId,
                  salon_id: salonResult.id,
                  role: 'owner'
              }]);

          if (linkError) {
              throw new Error(linkError.message);
          }

          // Store salon data for dashboard
          localStorage.setItem('salonInfo', JSON.stringify({
              salonId: salonResult.id,
              salonName: salonData.salon_name,
              plan: paymentData.plan
          }));

          // Clear session storage
          sessionStorage.removeItem('pendingUser');
          sessionStorage.removeItem('paymentComplete');

          // Show success message
          successMessage.style.display = 'block';
          form.style.display = 'none';
          updateProgress(100);

          // Redirect to dashboard
          setTimeout(() => {
              window.location.href = 'dashboard.html?onboarding=complete';
          }, 2000);

      } catch (error) {
          console.error('Salon creation error:', error);
          alert('Error: ' + error.message);
      } finally {
          // Reset loading state
          submitBtn.disabled = false;
          loading.style.display = 'none';
          submitText.textContent = 'Complete Setup & Go to Dashboard';
      }
  });

  // Initialize progress
  updateProgress(calculateProgress());
</script>
</body>
</html>